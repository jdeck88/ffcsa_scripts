<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fulfillment Data</title>
    <!-- Include Bootstrap CSS for styling -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Include DataTables CSS for table styling -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <!-- Custom CSS for styling -->
    <style>
        body {
            padding: 20px;
        }
        .container {
            width: 90%;
            margin: auto;
        }
        .dataTables_length {
            display: none; /* Hide "Show entries" */
        }
        .dropdown {
            margin-bottom: 10px;
        }
        #selectedFulfillmentName {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4 mb-4">Fulfillment Data</h1>

        <!-- Dropdown to select fulfillmentName -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="fulfillmentDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select Fulfillment Name
            </button>
            <div class="dropdown-menu" aria-labelledby="fulfillmentDropdown" id="dropdownMenu">
                <!-- Options will be populated dynamically -->
            </div>
        </div>

        <!-- Display selected fulfillmentName -->
        <div id="selectedFulfillmentName"></div>

        <!-- Table to display fulfillment data -->
        <table id="fulfillmentTable" class="table table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Date Range</th>
                    <th>Total</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <!-- Include DataTables JS for table functionality -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <!-- Custom JavaScript to populate dropdown and initialize DataTable -->
    <script>
$(document).ready(function() {
    let jsonData; // Variable to hold JSON data

    // Fetch JSON data using AJAX
    $.ajax({
        url: 'https://raw.githubusercontent.com/jdeck88/ffcsa_scripts/main/localline/data/fulfillment_kpi.json',
        dataType: 'json',
        success: function(data) {
            jsonData = data; // Store JSON data for later use

            // Populate dropdown menu with fulfillmentNames
            const dropdownMenu = $('#dropdownMenu');
            const fulfillmentNames = getFulfillmentNames(data.weeks);

            fulfillmentNames.forEach((name, index) => {
                dropdownMenu.append(`<a class="dropdown-item" href="#" data-index="${index}">${name}</a>`);
            });

            // Handle click on dropdown item
            dropdownMenu.on('click', '.dropdown-item', function(e) {
                e.preventDefault();
                const index = $(this).data('index');
                const fulfillmentName = fulfillmentNames[index];

                // Display selected fulfillmentName at the top of the table
                $('#selectedFulfillmentName').text(fulfillmentName);

                // Filter data for selected fulfillmentName
                const filteredData = filterDataByFulfillmentName(jsonData.weeks, fulfillmentName);

                // Update table with filtered data
                updateTable(filteredData);
            });

            // Initialize DataTable with empty data
            $('#fulfillmentTable').DataTable({
                data: [],
                columns: [
                    { data: 'dateRange' },
                    { data: 'total' },
                    { data: 'count' }
                ],
                paging: false,
                searching: false,
                info: false
            });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching data:', error);
        }
    });

    // Function to extract unique fulfillmentNames
    function getFulfillmentNames(weeks) {
        const names = new Set();
        weeks.forEach(week => {
            week.data.forEach(entry => {
                names.add(entry.fulfillmentName);
            });
        });
        return Array.from(names);
    }

    // Function to filter data by fulfillmentName
    function filterDataByFulfillmentName(weeks, fulfillmentName) {
        const filteredData = [];
        weeks.forEach(week => {
            week.data.forEach(entry => {
                if (entry.fulfillmentName === fulfillmentName) {
                    filteredData.push({
                        dateRange: week.dateRange,
                        total: entry.total,
                        count: entry.count
                    });
                }
            });
        });
        return filteredData;
    }

    // Function to update DataTable with new data
    function updateTable(data) {
        const table = $('#fulfillmentTable').DataTable();
        table.clear().rows.add(data).draw();
    }
});

    </script>
</body>
</html>

